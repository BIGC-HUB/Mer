[
  "# MongoDB API\n\n*直接复制保存为mongo.js运行测试*\n\n```js\nconst log = console.log.bind(console)\n// 添加 Path 环境变量 C:\\Program Files\\MongoDB\\Server\\3.4\\bin\n// 运行数据库 $ mongod --dbpath C:\\Users\\iwang\\Documents\\Github\\mer\\data\\db\nconst mongodb = require('mongodb')\n// 启动 mongodb\nconst stratdb = async (url) => {\n    try {\n        const db = await mongodb.connect(url)\n        return db\n    } catch(err) {\n        console.log('mongodb://localhost:27017 端口未开启，请检查')\n        return false\n    }\n}\n\n// 条件查询参考 http://www.jianshu.com/p/d8406b1cb028\n\n// 增删改查\nconst add = async(e, data) => {\n    // insertMany 是一次插入多条记录\n    const result = await e.insertMany(data)\n    log('添加成功！', result)\n}\nconst find = async(e, query) => {\n    const result = await e.find(query).toArray()\n    log('查找完成！', result)\n}\nconst update = async(e, query, form) => {\n    // updateOne 更新第一条 updateMany 更新所有\n    const before = await e.find(query).toArray()\n    log('更新前：', before)\n\n    await e.updateMany(query, form)\n\n    const after = await e.find(query).toArray()\n    log('更新后：', after)\n}\nconst remove = async(e, query) => {\n    // deleteOne 删除第一条 deleteMany 删除所有\n    const before = await e.find(query).toArray()\n    log('删除前：', before)\n\n    await e.deleteOne(query)\n\n    const after = await e.find(query).toArray()\n    log('删除后：', after)\n}\n\nconst test = async () => {\n    // 数据库的地址 + 默认端口\n    const url = 'mongodb://localhost:27017/'\n    // 数据库的名称\n    const dbname = 'node'\n    // 检测 mongodb 是否启动\n    let db = await stratdb(url + dbname)\n    if (db !== false) {\n        // 选择对应的 类\n        const e = db.collection('test')\n\n        const data = [\n            {\n                content: '孩子吃饭老不好，多半是装的',\n                user_id: 1,\n                username: 'gua',\n                note: {\n                    dx: 'daxiao',\n                    ren: {\n                        meng: \"meng\",\n                        qiang: {\n                            ying:\"ying\",\n                            mazi: {\n                                shuang: 'shuang'\n                            }\n                        }\n                    }\n                }\n            },\n            {\n                content: '睡觉',\n                done: true,\n                username: 'gua2',\n            },\n        ]\n        add(e, data)\n\n        const query = {\n            // 查找 random 不等于 dudu 的 （就是全部）\n            random: {$ne: 'dudu'},\n        }\n        // remove(e, query)\n\n        const query1 = {\n            // 查找 username 等于 'gua' 的\n            username: 'gua',\n        }\n        // find(e, query1)\n\n        const query2 = {\n            // 查找 content 等于 '睡觉' 的\n            content: '睡觉',\n        }\n        const form1 = {\n            // $set 新增 updated_time\n            $set: {\n                updated_time: Date.now()\n            }\n        }\n        // update(e, query2, form1)\n    }\n}\n\nif (require.main === module) {\n    test()\n}\n```"
]